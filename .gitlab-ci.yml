build:
  image: node:lts
  script:
    - (cd resources/legal/privacy && ln -s `ls | sort -V | tail -n1` ../privacy.md)
    - (cd resources/legal/terms && ln -s `ls | sort -V | tail -n1` ../terms.md)
    - yarn install --frozen-lockfile
    - yarn build
  artifacts:
    paths:
      - dist/

deploy:
  image: python:3-alpine
  variables:
    AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
    AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    BUCKET_NAME: ${BUCKET_NAME}
  script:
  - apk add yarn make
  - yarn install
  - yarn run build
  - pip install awscli
  - make deploy
  only:
  - master
